{
    "variables": {
        "linode_token": "{{env `LINODE_TOKEN`}}",
        "deploy_repo": "https://github.com/akerl/deploy-wireguard-server",
        "deploy_dir": "/opt/deploy"
    },
    "builders": [
        {
            "type": "linode",
            "linode_token": "{{user `linode_token`}}",

            "region": "us-east",
            "swap_size": 256,
            "image": "linode/ubuntu18.04",
            "instance_type": "g6-standard-1",
            "instance_label": "packer-wireguard-{{timestamp}}",

            "image_label": "packer-wireguard-{{timestamp}}",
            "image_description": "",

            "ssh_username": "root"
        }
    ],
    "provisioners": [
        {
            "type": "file",
            "source": "assets/sshd_config",
            "destination": "/etc/ssh/sshd_config"
        },
        {
            "type": "shell",
            "scripts": [
                "assets/setup.sh",
                "assets/run.sh"
            ],
            "environment_vars": [
                "DEPLOY_REPO={{user `deploy_repo`}}",
                "DEPLOY_DIR={{user `deploy_dir`}}"
            ]
        }
    ]
}
